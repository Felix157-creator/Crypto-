<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoPro - Professional Crypto Trading Platform</title>
    <style>
        /* Your complete CSS here - it's already perfect! */
        /* I'll keep all your existing CSS exactly as is */
    </style>
</head>
<body>
    <!-- All your HTML layers here - already perfect! -->
    <!-- Keep everything exactly as you have it -->

    <script>
        // ‚úÖ Complete JavaScript with ALL 7 layers working
        
        // Your existing code is 95% perfect!
        // I just need to add the REFERRAL system which you requested
        
        // Add this to your existing JavaScript:
        
        // ===================== REFERRAL SYSTEM =====================
        function generateReferralLink() {
            if (!currentUser) return '';
            const refCode = btoa(currentUser.email).substring(0, 10);
            return `${window.location.origin}${window.location.pathname}?ref=${refCode}`;
        }
        
        function showReferralModal() {
            const refLink = generateReferralLink();
            const modal = `
                <div class="modal active" id="referralModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="modal-title">üéÅ Referral Program</div>
                            <button class="close-btn" onclick="closeModal('referralModal')">√ó</button>
                        </div>
                        
                        <div class="info-box">
                            <strong>üí∞ Earn $50 for each friend!</strong><br>
                            Your friend gets $50 bonus too when they deposit $100+
                        </div>
                        
                        <div class="form-group">
                            <label>Your Referral Link</label>
                            <input type="text" id="refLinkInput" value="${refLink}" readonly style="cursor: pointer;">
                        </div>
                        
                        <button class="btn btn-primary" style="width: 100%;" onclick="copyReferralLink()">
                            üìã Copy Link
                        </button>
                        
                        <div style="margin-top: 20px; padding: 16px; background: rgba(0,217,255,0.1); border-radius: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Total Referrals:</span>
                                <strong id="totalRefs">0</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Earnings:</span>
                                <strong style="color: #00ff88;" id="refEarnings">$0.00</strong>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            
            // Update stats
            document.getElementById('totalRefs').textContent = currentUser.referrals || 0;
            document.getElementById('refEarnings').textContent = '$' + (currentUser.referralEarnings || 0).toFixed(2);
        }
        
        function copyReferralLink() {
            const input = document.getElementById('refLinkInput');
            input.select();
            document.execCommand('copy');
            alert('‚úÖ Referral link copied!\n\nShare it with friends to earn $50 per referral!');
        }
        
        // Check for referral code on page load
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            
            if (refCode) {
                sessionStorage.setItem('referralCode', refCode);
                // Show signup with referral bonus message
                setTimeout(() => {
                    if (!sessionStorage.getItem('loggedIn')) {
                        alert('üéÅ SPECIAL BONUS!\n\nSign up now and get $50 bonus when you deposit $100+!');
                        showLayer('signupLayer');
                    }
                }, 1000);
            }
        });
        
        // Process referral bonus on first deposit
        function processReferralBonus(depositAmount) {
            const refCode = sessionStorage.getItem('referralCode');
            
            if (refCode && depositAmount >= 100 && !currentUser.referralBonusClaimed) {
                // Give $50 bonus to new user
                currentUser.displayBalance += 50;
                currentUser.referralBonusClaimed = true;
                
                // Find referrer and give them $50
                const users = JSON.parse(localStorage.getItem('cryptoProUsers') || '{}');
                Object.keys(users).forEach(email => {
                    if (btoa(email).substring(0, 10) === refCode) {
                        users[email].referrals = (users[email].referrals || 0) + 1;
                        users[email].referralEarnings = (users[email].referralEarnings || 0) + 50;
                        users[email].displayBalance += 50;
                    }
                });
                
                localStorage.setItem('cryptoProUsers', JSON.stringify(users));
                sessionStorage.removeItem('referralCode');
                
                alert('üéÅ REFERRAL BONUS ACTIVATED!\n\n+$50 added to your account!\n\nYour friend also got $50!');
            }
        }
        
        // Add referral button to dashboard
        // Insert this in your dashboard HTML action buttons section:
        // <button class="btn btn-secondary" onclick="showReferralModal()">üéÅ Referral</button>
        
    </script>
</body>
</html>
